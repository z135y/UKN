<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f9f9f9; }
      h2 { color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
      .list-group { list-style: none; padding: 0; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-radius: 8px; }
      .list-item { padding: 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer; transition: 0.2s; }
      .list-item:hover { background-color: #f0f0f0; }
      .list-item:last-child { border-bottom: none; }
      .icon { margin-right: 15px; font-size: 1.2em; }
      a { text-decoration: none; color: #333; flex-grow: 1; display: block; }
      .folder-name { font-weight: bold; color: #2196F3; }
      .btn-back { background: #666; color: white; padding: 5px 15px; border-radius: 4px; border: none; cursor: pointer; margin-bottom: 15px; }
    </style>
  </head>
  <body>
    
    <div id="app">
      <button id="backBtn" class="btn-back" style="display:none;" onclick="loadFolder(currentParentId)">â¬… è¿”å›ä¸Šä¸€å±¤</button>
      <h2 id="folderTitle">è¼‰å…¥ä¸­...</h2>
      <ul id="fileList" class="list-group"></ul>
    </div>

    <script>
      var currentParentId = null;

      // åˆå§‹åŒ–ï¼šè¼‰å…¥æ ¹ç›®éŒ„
      window.onload = function() {
        loadFolder(); 
      };

      function loadFolder(folderId) {
        document.getElementById('fileList').innerHTML = '<li class="list-item">è¼‰å…¥è³‡æ–™ä¸­...</li>';
        google.script.run.withSuccessHandler(renderList).getContent(folderId);
      }

      function renderList(data) {
        var listHtml = '';
        var title = document.getElementById('folderTitle');
        var backBtn = document.getElementById('backBtn');
        
        // æ›´æ–°æ¨™é¡Œèˆ‡ç‹€æ…‹
        title.innerText = data.currentName;
        currentParentId = data.parentId;
        
        // æ§åˆ¶è¿”å›æŒ‰éˆ•é¡¯ç¤º
        if (data.parentId && data.parentId !== 'https://script.google.com/macros/s/AKfycbzgosunS6QAlR8b8AvcIVEOSBdpEyi9mleaGbksVF3LOPOgKKZGTN2XvIhQ2dHlCFh2/exec') { // å¯é¸ï¼šé˜²æ­¢è¿”å›åˆ°æ ¹ç›®éŒ„ä»¥ä¸Š
           backBtn.style.display = 'inline-block';
        } else {
           // è¦–éœ€æ±‚æ±ºå®šæ˜¯å¦éš±è—æ ¹ç›®éŒ„çš„è¿”å›éµ
           backBtn.style.display = (data.parentId) ? 'inline-block' : 'none';
        }

        // æ¸²æŸ“åˆ—è¡¨
        if (data.items.length === 0) {
          listHtml = '<li class="list-item">æ­¤è³‡æ–™å¤¾ç‚ºç©º</li>';
        } else {
          data.items.forEach(function(item) {
            if (item.type === 'folder') {
              // é»æ“Šè³‡æ–™å¤¾ï¼šå‘¼å«å¾Œç«¯è®€å–ä¸‹ä¸€å±¤
              listHtml += `<li class="list-item" onclick="loadFolder('${item.id}')">
                             <span class="icon">ğŸ“</span>
                             <span class="folder-name">${item.name}</span>
                           </li>`;
            } else {
              // é»æ“Šæª”æ¡ˆï¼šç›´æ¥æ‰“é–‹é€£çµ
              listHtml += `<li class="list-item">
                             <span class="icon">${item.icon}</span>
                             <a href="${item.url}" target="_blank">${item.name}</a>
                           </li>`;
            }
          });
        }
        document.getElementById('fileList').innerHTML = listHtml;
      }
    </script>
  </body>

</html>
